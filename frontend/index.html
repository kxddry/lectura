<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lectura - AI-Powered Learning Enhancement</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --primary: #6d28d9;
            --primary-dark: #5b21b6;
            --secondary: #10b981;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--darker);
            color: var(--light);
            min-height: 100vh;
        }

        .gradient-text {
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .slide-fade-enter-active {
            transition: all 0.3s ease-out;
        }

        .slide-fade-leave-active {
            transition: all 0.3s cubic-bezier(1, 0.5, 0.8, 1);
        }

        .slide-fade-enter-from,
        .slide-fade-leave-to {
            transform: translateY(20px);
            opacity: 0;
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(109, 40, 217, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(109, 40, 217, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(109, 40, 217, 0);
            }
        }

        .file-upload-container {
            border: 2px dashed #334155;
            transition: all 0.3s ease;
        }

        .file-upload-container:hover {
            border-color: var(--primary);
            background-color: rgba(109, 40, 217, 0.05);
        }

        .file-upload-container.dragover {
            border-color: var(--secondary);
            background-color: rgba(16, 185, 129, 0.05);
        }

        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-0 {
            background-color: rgba(251, 191, 36, 0.1);
            color: #f59e0b;
        }

        .status-1 {
            background-color: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .status-2 {
            background-color: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .glow-effect {
            position: relative;
        }

        .glow-effect::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(109, 40, 217, 0.3) 0%, transparent 70%);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .glow-effect:hover::after {
            opacity: 1;
        }
    </style>
</head>
<body>
<div id="app" class="min-h-screen flex flex-col">
    <!-- Navigation -->
    <nav class="bg-gray-900 border-b border-gray-800 py-4 px-6 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center">
                    <i class="fas fa-brain text-white"></i>
                </div>
                <span class="text-xl font-bold gradient-text">Lectura</span>
            </div>

            <div class="hidden md:flex items-center space-x-6">
                <a href="#" @click="currentView = 'dashboard'" class="hover:text-purple-400 transition-colors" :class="{'text-purple-400': currentView === 'dashboard'}">Dashboard</a>
                <a href="#" @click="currentView = 'files'" class="hover:text-purple-400 transition-colors" :class="{'text-purple-400': currentView === 'files'}">My Files</a>
            </div>

            <div class="flex items-center space-x-4">
                <template v-if="isAuthenticated">
                    <button @click="logout" class="px-4 py-2 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors text-sm font-medium">
                        Logout
                    </button>
                </template>
                <template v-else>
                    <button @click="currentView = 'login'" class="px-4 py-2 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors text-sm font-medium">
                        Login
                    </button>
                    <button @click="goToRegister" class="px-4 py-2 rounded-md bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 transition-colors text-sm font-medium">
                        Get Started
                    </button>
                </template>
                <button class="md:hidden text-gray-400 hover:text-white">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow">
        <transition-group name="slide-fade" mode="out-in">
            <!-- Dashboard View -->
            <div v-if="currentView === 'dashboard' && isAuthenticated" key="dashboard" class="max-w-7xl mx-auto px-6 py-12">
                <div class="text-center mb-12">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">Enhance Your <span class="gradient-text">Learning Power</span></h1>
                    <p class="text-lg text-gray-400 max-w-2xl mx-auto">
                        Upload your lectures and get AI-powered summaries to help you learn faster and retain more information.
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                    <div class="bg-gray-900 rounded-xl p-6 border border-gray-800 hover:border-purple-500 transition-colors">
                        <div class="w-12 h-12 rounded-full bg-purple-900 flex items-center justify-center mb-4">
                            <i class="fas fa-upload text-purple-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Upload</h3>
                        <p class="text-gray-400">Upload your lecture videos or audio files in any format.</p>
                    </div>
                    <div class="bg-gray-900 rounded-xl p-6 border border-gray-800 hover:border-blue-500 transition-colors">
                        <div class="w-12 h-12 rounded-full bg-blue-900 flex items-center justify-center mb-4">
                            <i class="fas fa-headphones text-blue-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Transcribe</h3>
                        <p class="text-gray-400">Our AI automatically transcribes your content with high accuracy.</p>
                    </div>
                    <div class="bg-gray-900 rounded-xl p-6 border border-gray-800 hover:border-green-500 transition-colors">
                        <div class="w-12 h-12 rounded-full bg-green-900 flex items-center justify-center mb-4">
                            <i class="fas fa-file-alt text-green-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Summarize</h3>
                        <p class="text-gray-400">Get concise summaries highlighting key concepts and takeaways.</p>
                    </div>
                </div>

                <div class="bg-gray-900 rounded-xl p-8 border border-gray-800">
                    <div class="flex flex-col md:flex-row items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold mb-4 md:mb-0">Upload New Lecture</h2>
                        <div class="flex space-x-2">
                            <button @click="showVideoForm = true" class="px-4 py-2 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors text-sm font-medium" :class="{'bg-purple-900 text-purple-400': showVideoForm}">
                                <i class="fas fa-video mr-2"></i> Video
                            </button>
                            <button @click="showVideoForm = false" class="px-4 py-2 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors text-sm font-medium" :class="{'bg-purple-900 text-purple-400': !showVideoForm}">
                                <i class="fas fa-microphone mr-2"></i> Audio
                            </button>
                        </div>
                    </div>

                    <div @dragover.prevent="isDragging = true"
                         @dragleave.prevent="isDragging = false"
                         @drop.prevent="handleDrop"
                         :class="{'file-upload-container dragover': isDragging, 'file-upload-container': !isDragging}"
                         class="rounded-lg p-8 text-center cursor-pointer transition-all duration-300 mb-6">
                        <input type="file" ref="fileInput" @change="handleFileSelect" class="hidden" accept="video/*,audio/*">

                        <div class="flex flex-col items-center justify-center space-y-4">
                            <div class="w-16 h-16 rounded-full bg-purple-900 flex items-center justify-center pulse-animation">
                                <i class="fas fa-cloud-upload-alt text-2xl text-purple-400"></i>
                            </div>
                            <h3 class="text-xl font-semibold">
                                <span v-if="!isDragging">Drag & Drop your {{ showVideoForm ? 'video' : 'audio' }} here</span>
                                <span v-else class="text-purple-400">Drop to upload</span>
                            </h3>
                            <p class="text-gray-400">or <span class="text-purple-400 cursor-pointer" @click="triggerFileInput">click to browse</span></p>
                            <p class="text-sm text-gray-500">Supports: {{ showVideoForm ? 'MP4, MOV, AVI, etc.' : 'MP3, WAV, M4A, etc.' }} (Max 2GB)</p>
                        </div>
                    </div>

                    <div v-if="selectedFile" class="bg-gray-800 rounded-lg p-4 flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <i class="fas" :class="showVideoForm ? 'fa-video text-purple-400' : 'fa-microphone text-blue-400'"></i>
                            <div>
                                <p class="font-medium">{{ selectedFile.name }}</p>
                                <p class="text-sm text-gray-400">{{ formatFileSize(selectedFile.size) }}</p>
                            </div>
                        </div>
                        <button @click="removeFile" class="text-gray-400 hover:text-red-400">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="flex justify-end">
                        <button @click="uploadFile" :disabled="!selectedFile || isUploading" class="px-6 py-3 rounded-md bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 transition-colors font-medium flex items-center" :class="{'opacity-50 cursor-not-allowed': !selectedFile || isUploading}">
                            <span v-if="!isUploading">Upload Lecture</span>
                            <span v-else>Uploading...</span>
                            <i v-if="isUploading" class="fas fa-circle-notch loading-spinner ml-2"></i>
                            <i v-else class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Files View -->
            <div v-else-if="currentView === 'files' && isAuthenticated" key="files" class="max-w-7xl mx-auto px-6 py-12">
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8">
                    <h1 class="text-3xl font-bold mb-4 md:mb-0">My Lecture Files</h1>
                    <div class="flex space-x-3">
                        <div class="relative">
                            <select v-model="filterStatus" class="appearance-none bg-gray-900 border border-gray-700 rounded-md pl-4 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="all">All Statuses</option>
                                <option value="0">Uploaded</option>
                                <option value="1">Transcribed</option>
                                <option value="2">Summarized</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                        <button @click="refreshFiles" class="px-4 py-2 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors text-sm font-medium flex items-center">
                            <i class="fas fa-sync-alt mr-2" :class="{'loading-spinner': isRefreshing}"></i>
                            Refresh
                        </button>
                    </div>
                </div>

                <div v-if="isLoadingFiles" class="flex justify-center items-center py-12">
                    <div class="animate-pulse flex flex-col items-center">
                        <i class="fas fa-circle-notch loading-spinner text-4xl text-purple-400 mb-4"></i>
                        <p class="text-gray-400">Loading your files...</p>
                    </div>
                </div>

                <div v-else>
                    <div v-if="filteredFiles.length === 0" class="bg-gray-900 rounded-xl p-12 text-center border border-dashed border-gray-800">
                        <div class="w-20 h-20 rounded-full bg-gray-800 flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-folder-open text-3xl text-gray-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">No files found</h3>
                        <p class="text-gray-400 mb-6">Upload your first lecture to get started</p>
                        <button @click="currentView = 'dashboard'" class="px-6 py-2 rounded-md bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 transition-colors font-medium">
                            Upload Lecture
                        </button>
                    </div>

                    <div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div v-for="file in filteredFiles" :key="file.uuid"
                             class="bg-gray-800 rounded-lg p-4 hover:bg-gray-700 transition-colors group">
                            <div class="flex items-center space-x-3 mb-3">
                                <div class="w-10 h-10 rounded-full bg-gray-700 group-hover:bg-purple-900 transition-colors flex items-center justify-center">
                                    <i class="fas" :class="getFileIcon(file.mime_type)"></i>
                                </div>
                                <div>
                                    <h3 class="font-medium truncate">{{ file.name }}</h3>
                                    <div class="flex items-center space-x-2 text-xs text-gray-400">
                                        <span>{{ getFileType(file.mime_type) }}</span>
                                        <span>•</span>
                                        <span class="status-badge" :class="'status-' + file.status">
                                            {{ getStatusText(file.status) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="aspect-video bg-gray-800/50 backdrop-blur-sm rounded-lg flex items-center justify-center mb-2 p-4 shadow-xl">
                                <template v-if="file.mime_type.includes('video')">
                                    <div class="w-full h-full flex items-center justify-center relative group">
                                        <video 
                                            controls 
                                            :src="file.url" 
                                            :type="file.mime_type" 
                                            class="w-full h-40 rounded-lg shadow-lg border border-purple-500/30 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all duration-300 group-hover:border-purple-500"
                                            style="background: rgba(109, 40, 217, 0.05);"
                                        >
                                            Your browser does not support the video tag.
                                        </video>
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg pointer-events-none"></div>
                                    </div>
                                </template>
                                <template v-else-if="file.mime_type.includes('audio')">
                                    <div class="w-full flex items-center justify-center relative group">
                                        <div class="w-full bg-gray-900/50 rounded-lg p-4 backdrop-blur-sm border border-blue-500/30 group-hover:border-blue-500 transition-all duration-300">
                                            <div class="flex items-center space-x-4 mb-3">
                                                <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center">
                                                    <i class="fas fa-music text-blue-400"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <div class="h-1 bg-blue-900/50 rounded-full overflow-hidden">
                                                        <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500 w-0 group-hover:w-full transition-all duration-3000 ease-out"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <audio 
                                                controls 
                                                :src="file.url" 
                                                :type="file.mime_type" 
                                                class="w-full focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            >
                                                Your browser does not support the audio element.
                                            </audio>
                                        </div>
                                    </div>
                                </template>
                                <template v-else>
                                    <i class="fas" :class="getFileIcon(file.mime_type) + ' text-3xl text-gray-400'" style="margin: auto;"></i>
                                </template>
                            </div>
                            <button @click="openFilePreview(file)" class="w-full mt-2 px-4 py-2 rounded-md bg-gray-700 hover:bg-purple-600 transition-colors text-sm font-medium">View Details</button>
                            <template>
                                <div>
                                    {{ fileContent.value }}
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Login View -->
            <div v-else-if="currentView === 'login'" key="login" class="max-w-md mx-auto px-6 py-16">
                <div class="bg-gray-900 rounded-xl p-8 border border-gray-800">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-brain text-2xl text-white"></i>
                        </div>
                        <h1 class="text-2xl font-bold mb-2">Welcome back</h1>
                        <p class="text-gray-400">Sign in to your Lectura account</p>
                    </div>

                    <form @submit.prevent="handleLogin" class="space-y-6">
                        <div>
                            <label for="login-email" class="block text-sm font-medium text-gray-300 mb-1">Email</label>
                            <input v-model="loginForm.email" type="email" id="login-email" required class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors" placeholder="your@email.com">
                        </div>

                        <div>
                            <label for="login-password" class="block text-sm font-medium text-gray-300 mb-1">Password</label>
                            <input v-model="loginForm.password" type="password" id="login-password" required class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors" placeholder="••••••••">
                        </div>

                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input v-model="loginForm.remember" type="checkbox" id="remember-me" class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-600 rounded bg-gray-700">
                                <label for="remember-me" class="ml-2 block text-sm text-gray-300">Remember me</label>
                            </div>
                            <a href="#" class="text-sm text-purple-400 hover:text-purple-300">Forgot password?</a>
                        </div>

                        <button type="submit" :disabled="isLoggingIn" class="w-full px-6 py-3 rounded-md bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 transition-colors font-medium flex items-center justify-center" :class="{'opacity-50 cursor-not-allowed': isLoggingIn}">
                            <span v-if="!isLoggingIn">Sign In</span>
                            <span v-else>Signing In...</span>
                            <i v-if="isLoggingIn" class="fas fa-circle-notch loading-spinner ml-2"></i>
                        </button>
                    </form>

                    <div class="mt-6 text-center text-sm text-gray-400">
                        Don't have an account? <a href="#" @click="currentView = 'register'" class="text-purple-400 hover:text-purple-300">Sign up</a>
                    </div>
                </div>
            </div>

            <!-- Register View -->
            <div v-else-if="currentView === 'register'" key="register" class="max-w-md mx-auto px-6 py-16">
                <div class="bg-gray-900 rounded-xl p-8 border border-gray-800">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-brain text-2xl text-white"></i>
                        </div>
                        <h1 class="text-2xl font-bold mb-2">Create your account</h1>
                        <p class="text-gray-400">Start enhancing your learning today</p>
                    </div>

                    <form @submit.prevent="handleRegister" class="space-y-6">
                        <div>
                            <label for="register-email" class="block text-sm font-medium text-gray-300 mb-1">Email</label>
                            <input v-model="registerForm.email" type="email" id="register-email" required class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors" placeholder="your@email.com">
                        </div>

                        <div>
                            <label for="register-password" class="block text-sm font-medium text-gray-300 mb-1">Password</label>
                            <div class="relative">
                                <input v-model="registerForm.password" :type="showPassword ? 'text' : 'password'" id="register-password" required class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors pr-10" placeholder="••••••••">
                                <button type="button" @click="showPassword = !showPassword" class="absolute right-2 top-2 text-gray-400 hover:text-purple-400 focus:outline-none">
                                    <i :class="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                </button>
                            </div>
                            <ul class="mt-2 text-xs space-y-1.5">
                                <li class="flex items-center space-x-2" :class="{'text-green-400': passwordRequirements.length, 'text-gray-400': !passwordRequirements.length}">
                                    <i class="fas" :class="passwordRequirements.length ? 'fa-check-circle' : 'fa-circle'"></i>
                                    <span>At least 8 characters</span>
                                </li>
                                <li class="flex items-center space-x-2" :class="{'text-green-400': passwordRequirements.number, 'text-gray-400': !passwordRequirements.number}">
                                    <i class="fas" :class="passwordRequirements.number ? 'fa-check-circle' : 'fa-circle'"></i>
                                    <span>At least one number</span>
                                </li>
                                <li class="flex items-center space-x-2" :class="{'text-green-400': passwordRequirements.uppercase, 'text-gray-400': !passwordRequirements.uppercase}">
                                    <i class="fas" :class="passwordRequirements.uppercase ? 'fa-check-circle' : 'fa-circle'"></i>
                                    <span>At least one uppercase letter</span>
                                </li>
                                <li class="flex items-center space-x-2" :class="{'text-green-400': passwordRequirements.lowercase, 'text-gray-400': !passwordRequirements.lowercase}">
                                    <i class="fas" :class="passwordRequirements.lowercase ? 'fa-check-circle' : 'fa-circle'"></i>
                                    <span>At least one lowercase letter</span>
                                </li>
                                <li class="flex items-center space-x-2" :class="{'text-green-400': passwordRequirements.special, 'text-gray-400': !passwordRequirements.special}">
                                    <i class="fas" :class="passwordRequirements.special ? 'fa-check-circle' : 'fa-circle'"></i>
                                    <span>At least one special symbol</span>
                                </li>
                            </ul>
                            <div class="h-1 mt-3 bg-gray-700 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 transition-all duration-300"
                                     :style="{ width: (Object.values(passwordRequirements).filter(Boolean).length * 20) + '%' }"></div>
                            </div>
                        </div>

                        <div>
                            <label for="register-confirm-password" class="block text-sm font-medium text-gray-300 mb-1">Confirm Password</label>
                            <input v-model="registerForm.confirmPassword" type="password" id="register-confirm-password" required class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors" placeholder="••••••••">
                        </div>

                        <div class="flex items-center">
                            <input v-model="registerForm.agreeTerms" type="checkbox" id="agree-terms" required class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-600 rounded bg-gray-700">
                            <label for="agree-terms" class="ml-2 block text-sm text-gray-300">
                                I agree to the <a href="#" class="text-purple-400 hover:text-purple-300">Terms of Service</a> and <a href="#" class="text-purple-400 hover:text-purple-300">Privacy Policy</a>
                            </label>
                        </div>

                        <button type="submit" :disabled="isRegistering" class="w-full px-6 py-3 rounded-md bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 transition-colors font-medium flex items-center justify-center" :class="{'opacity-50 cursor-not-allowed': isRegistering}">
                            <span v-if="!isRegistering">Create Account</span>
                            <span v-else>Creating Account...</span>
                            <i v-if="isRegistering" class="fas fa-circle-notch loading-spinner ml-2"></i>
                        </button>
                        <div v-if="registrationErrors.length" class="mt-4 text-sm text-red-400">
                            <ul>
                                <li v-for="err in registrationErrors" :key="err">{{ err }}</li>
                            </ul>
                        </div>
                    </form>

                    <div class="mt-6 text-center text-sm text-gray-400">
                        Already have an account? <a href="#" @click="currentView = 'login'" class="text-purple-400 hover:text-purple-300">Sign in</a>
                    </div>
                </div>
            </div>

            <!-- File Preview Modal -->
            <div v-if="showFilePreview" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 px-4 py-6" @click.self="showFilePreview = false">
                <div class="bg-gray-900/95 backdrop-filter backdrop-blur rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col border border-gray-800/50 shadow-2xl transform transition-all duration-300 scale-100">
                    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-800/50 bg-gray-900/50">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-600/20 to-pink-500/20 flex items-center justify-center">
                                <i :class="getFileIcon(currentPreviewFile.mime_type)" class="text-lg"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold">{{ currentPreviewFile.name }}</h3>
                                <p class="text-sm text-gray-400">{{ getFileType(currentPreviewFile.mime_type) }} File</p>
                            </div>
                        </div>
                        <button @click="showFilePreview = false" class="w-8 h-8 rounded-full bg-gray-800/50 hover:bg-gray-700 transition-colors flex items-center justify-center">
                            <i class="fas fa-times text-gray-400"></i>
                        </button>
                    </div>

                    <div class="flex-grow overflow-y-auto p-6 space-y-6">
                        <div class="aspect-video bg-gray-800/50 backdrop-blur-sm rounded-xl overflow-hidden relative group">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <video v-if="currentPreviewFile.mime_type.includes('video')" controls class="w-full h-full">
                                <source :src="currentPreviewFile.url" :type="currentPreviewFile.mime_type">
                            </video>
                            <audio v-else-if="currentPreviewFile.mime_type.includes('audio')" controls class="w-full absolute bottom-0 left-0 right-0 p-4 bg-gray-900/80 backdrop-blur-sm">
                                <source :src="currentPreviewFile.url" :type="currentPreviewFile.mime_type">
                            </audio>
                        </div>

                        <div v-if="isLoadingFileContent" class="flex justify-center items-center h-32">
                            <div class="animate-pulse flex flex-col items-center">
                                <i class="fas fa-circle-notch loading-spinner text-3xl text-purple-400 mb-4"></i>
                                <p class="text-gray-400">Loading content...</p>
                            </div>
                        </div>

                        <div v-else class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-gray-800/50 rounded-lg p-4 backdrop-blur-sm border border-gray-700/50">
                                    <h4 class="text-sm font-semibold text-gray-400 mb-3">File Information</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">Status</span>
                                            <span class="status-badge" :class="'status-' + currentPreviewFile.status">
                                                {{ getStatusText(currentPreviewFile.status) }}
                                            </span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">Type</span>
                                            <span class="text-gray-300">{{ getFileType(currentPreviewFile.mime_type) }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gray-800/50 rounded-lg p-4 backdrop-blur-sm border border-gray-700/50">
                                    <h4 class="text-sm font-semibold text-gray-400 mb-3">Processing</h4>
                                    <div class="space-y-3">
                                        <div class="space-y-1">
                                            <div class="flex justify-between text-sm">
                                                <span class="text-gray-400">Progress</span>
                                                <span class="text-purple-400">{{ (currentPreviewFile.status + 1) * 33 }}%</span>
                                            </div>
                                            <div class="h-1.5 bg-gray-700 rounded-full overflow-hidden">
                                                <div class="h-full bg-gradient-to-r from-purple-600 to-pink-500" 
                                                     :style="{ width: (1 + currentPreviewFile.status) * 33 + '%' }"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-800/50 rounded-lg p-6 backdrop-blur-sm border border-gray-700/50">
                                <h4 class="text-lg font-semibold mb-4 text-purple-400">File Details</h4>
                                <div class="prose prose-invert max-w-none prose-p:text-gray-300 prose-headings:text-gray-200">
                                    <div v-html="fileContent"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="px-6 py-4 border-t border-gray-800/50 bg-gray-900/50 flex justify-between">
                        <button v-if="currentPreviewFile.status === 2" 
                                @click="viewSummary(currentPreviewFile)" 
                                class="px-4 py-2 rounded-md bg-purple-600/20 text-purple-400 hover:bg-purple-600/30 transition-colors text-sm font-medium flex items-center space-x-2">
                            <i class="fas fa-book-open"></i>
                            <span>View Summary</span>
                        </button>
                        <div class="space-x-3">
                            <button @click="showFilePreview = false" 
                                    class="px-4 py-2 rounded-md bg-gray-800/80 hover:bg-gray-700 transition-colors text-sm font-medium">
                                Close
                            </button>
                            <button v-if="currentPreviewFile.status === 2" 
                                    class="px-4 py-2 rounded-md bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 transition-colors text-sm font-medium">
                                Download
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Modal -->
            <div v-if="showSummaryModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 px-4 py-6">
                <div class="bg-gray-900 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col border border-gray-800">
                    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-800">
                        <h3 class="text-lg font-semibold">{{ currentSummaryFile.name }}</h3>
                        <button @click="showSummaryModal = false" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="flex-grow overflow-y-auto p-6">
                        <div v-if="isLoadingSummary" class="flex justify-center items-center h-64">
                            <div class="animate-pulse flex flex-col items-center">
                                <i class="fas fa-circle-notch loading-spinner text-3xl text-purple-400 mb-4"></i>
                                <p class="text-gray-400">Generating summary...</p>
                            </div>
                        </div>

                        <div v-else class="prose prose-invert max-w-none">
                            <h3 class="text-xl font-semibold mb-4">AI-Generated Summary</h3>

                            <div class="bg-gray-800 rounded-lg p-4 mb-6">
                                <h4 class="font-medium text-purple-400 mb-2">Key Takeaways</h4>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>The lecture covers the fundamental principles of quantum mechanics</li>
                                    <li>Wave-particle duality is a core concept that explains behavior at atomic scales</li>
                                    <li>Heisenberg's uncertainty principle limits precision in measuring certain pairs of properties</li>
                                    <li>Quantum superposition allows particles to exist in multiple states simultaneously</li>
                                </ul>
                            </div>

                            <div class="mb-6">
                                <h4 class="font-medium text-purple-400 mb-2">Detailed Summary</h4>
                                <p class="mb-4">The lecture begins with an introduction to quantum mechanics, contrasting it with classical physics. The professor explains how quantum mechanics describes nature at the smallest scales of energy levels of atoms and subatomic particles.</p>

                                <p class="mb-4">A significant portion focuses on wave-particle duality, demonstrating how light and matter can exhibit properties of both waves and particles. The double-slit experiment is discussed as a key demonstration of this phenomenon.</p>

                                <p class="mb-4">The lecture then moves to Heisenberg's uncertainty principle, mathematically expressing a fundamental limit to the precision with which certain pairs of physical properties can be known. This leads to a discussion about the probabilistic nature of quantum mechanics.</p>

                                <p>Finally, quantum superposition is introduced, with examples showing how quantum systems can exist in multiple states simultaneously until measured. The professor relates this to modern applications like quantum computing.</p>
                            </div>

                            <div class="bg-gray-800 rounded-lg p-4">
                                <h4 class="font-medium text-purple-400 mb-2">Recommended Study Materials</h4>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>"Principles of Quantum Mechanics" by R. Shankar (Chapter 1-3)</li>
                                    <li>"Quantum Physics for Dummies" by Steven Holzner</li>
                                    <li>MIT OpenCourseWare: 8.04 Quantum Physics I</li>
                                    <li>Feynman Lectures on Physics, Volume III</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="px-6 py-4 border-t border-gray-800 flex justify-end">
                        <button @click="showSummaryModal = false" class="px-4 py-2 rounded-md bg-gray-800 hover:bg-gray-700 transition-colors text-sm font-medium">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </transition-group>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-800 py-8 px-6">
        <div class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-600 to-pink-500 flex items-center justify-center">
                            <i class="fas fa-brain text-white"></i>
                        </div>
                        <span class="text-xl font-bold gradient-text">Lectura</span>
                    </div>
                    <p class="text-gray-400 text-sm">Enhancing the learning power of millions through AI-powered lecture summarization.</p>
                </div>

                <div>
                    <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-300 mb-4">Product</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Features</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Pricing</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">API</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Integrations</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-300 mb-4">Resources</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Documentation</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Guides</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Blog</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Support</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-sm font-semibold uppercase tracking-wider text-gray-300 mb-4">Company</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">About</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Careers</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Privacy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">Terms</a></li>
                    </ul>
                </div>
            </div>

            <div class="pt-8 border-t border-gray-800 flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 text-sm mb-4 md:mb-0">© 2025 Lectura AI. All rights reserved.</p>
            </div>
        </div>
    </footer>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue;
    const md = window.markdownit ? window.markdownit() : null;

    createApp({
        setup() {
            // State management
            const currentView = ref('dashboard');
            const isAuthenticated = ref(false);
            const showVideoForm = ref(true);
            const isDragging = ref(false);
            const selectedFile = ref(null);
            const isUploading = ref(false);
            const files = ref([]);
            const isLoadingFiles = ref(false);
            const isRefreshing = ref(false);
            const filterStatus = ref('all');
            const showSummaryModal = ref(false);
            const currentSummaryFile = ref(null);
            const isLoadingSummary = ref(false);
            const showFilePreview = ref(false);
            const currentPreviewFile = ref(null);
            const fileContent = ref('');
            const isLoadingFileContent = ref(false);
            const showPassword = ref(false);
            const registrationErrors = ref([]);
            const passwordRequirements = ref({
                length: false,
                number: false,
                uppercase: false,
                lowercase: false,
                special: false
            });

            // Form data
            const loginForm = ref({
                email: '',
                password: '',
                remember: false
            });

            const registerForm = ref({
                email: '',
                password: '',
                confirmPassword: '',
                agreeTerms: false
            });

            const isLoggingIn = ref(false);
            const isRegistering = ref(false);

            // File input ref
            const fileInput = ref(null);

            // Computed properties
            const filteredFiles = computed(() => {
                if (filterStatus.value === 'all') return files.value;
                return files.value.filter(file => file.status.toString() === filterStatus.value);
            });

            // Methods
            const triggerFileInput = () => {
                fileInput.value.click();
            };

            const handleFileSelect = (event) => {
                const file = event.target.files[0];
                if (file) {
                    selectedFile.value = file;
                }
            };

            const handleDrop = (event) => {
                isDragging.value = false;
                const file = event.dataTransfer.files[0];
                if (file) {
                    // Check if file is video or audio based on showVideoForm
                    const fileType = file.type.split('/')[0];
                    if ((showVideoForm.value && fileType === 'video') || (!showVideoForm.value && fileType === 'audio')) {
                        selectedFile.value = file;
                    } else {
                        alert(`Please upload a ${showVideoForm.value ? 'video' : 'audio'} file`);
                    }
                }
            };

            const removeFile = () => {
                selectedFile.value = null;
                if (fileInput.value) {
                    fileInput.value.value = '';
                }
            };

            const formatFileSize = (bytes) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            };

            const getFileIcon = (mimeType) => {
                const type = mimeType.split('/')[0];
                switch(type) {
                    case 'video':
                        return 'fa-video text-purple-400';
                    case 'audio':
                        return 'fa-microphone text-blue-400';
                    default:
                        return 'fa-file text-gray-400';
                }
            };

            const getFileType = (mimeType) => {
                const type = mimeType.split('/')[1];
                return type ? type.toUpperCase() : 'FILE';
            };

            const getStatusText = (status) => {
                switch(status) {
                    case 0:
                        return 'Uploaded';
                    case 1:
                        return 'Transcribed';
                    case 2:
                        return 'Summarized';
                    default:
                        return 'Unknown';
                }
            };

            // API methods
            const checkAuth = async () => {
                try {
                    // Verify token by making a request to the backend
                    await axios.get('/api/v1/verify-token');
                    isAuthenticated.value = true;
                    await fetchFiles();
                } catch (error) {
                    isAuthenticated.value = false;
                    if (currentView.value !== 'login' && currentView.value !== 'register') {
                        currentView.value = 'login';
                    }
                }
            };

            const getCookie = (name) => {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            };

            const handleLogin = async () => {
                isLoggingIn.value = true;
                try {
                    const response = await axios.postForm('/api/v1/login', {
                        email: loginForm.value.email,
                        password: loginForm.value.password
                    });

                    // The backend sets the cookie, no need to set it manually
                    isAuthenticated.value = true;
                    currentView.value = 'dashboard';
                    await fetchFiles();
                } catch (error) {
                    alert('Login failed. Please check your credentials and try again.');
                    console.error('Login error:', error);
                } finally {
                    isLoggingIn.value = false;
                }
            };

            Vue.watch(() => registerForm.value.password, (newVal) => {
                passwordRequirements.value.length = newVal.length >= 8;
                passwordRequirements.value.number = /\d/.test(newVal);
                passwordRequirements.value.uppercase = /[A-Z]/.test(newVal);
                passwordRequirements.value.lowercase = /[a-z]/.test(newVal);
                passwordRequirements.value.special = /[^A-Za-z0-9]/.test(newVal);
            });

            const handleRegister = async () => {
                registrationErrors.value = [];
                const password = registerForm.value.password;
                const confirmPassword = registerForm.value.confirmPassword;
                const errors = [];
                if (password !== confirmPassword) {
                    errors.push('Passwords do not match');
                }
                if (!passwordRequirements.value.length) {
                    errors.push('Password must be at least 8 characters long.');
                }
                if (!passwordRequirements.value.number) {
                    errors.push('Password must contain at least one number.');
                }
                if (!passwordRequirements.value.uppercase) {
                    errors.push('Password must contain at least one uppercase letter.');
                }
                if (!passwordRequirements.value.lowercase) {
                    errors.push('Password must contain at least one lowercase letter.');
                }
                if (!passwordRequirements.value.special) {
                    errors.push('Password must contain at least one special symbol.');
                }
                if (errors.length > 0) {
                    registrationErrors.value = errors;
                    return;
                }
                isRegistering.value = true;
                try {
                    const response = await axios.postForm('/api/v1/register', {
                        email: registerForm.value.email,
                        password: registerForm.value.password
                    });
                    isAuthenticated.value = true;
                    currentView.value = 'dashboard';
                    await fetchFiles();
                } catch (error) {
                    registrationErrors.value = ['Registration failed. Please try again.'];
                } finally {
                    isRegistering.value = false;
                }
            };

            const logout = async () => {
                try {
                    await axios.post('/api/v1/logout', null, { withCredentials: true });
                } catch (e) {
                    console.warn('Logout error:', e);
                }

                document.cookie = 'access_token=; Max-Age=0;'; // на всякий случай
                localStorage.removeItem('access_token');
                sessionStorage.removeItem('access_token');
                isAuthenticated.value = false;
                files.value = [];
                currentView.value = 'login';
            };


            const uploadFile = async () => {
                if (!selectedFile.value) return;

                isUploading.value = true;
                try {
                    const response = await axios.postForm('/api/v1/upload', {
                        file: selectedFile.value
                    });

                    // Add the new file to the beginning of the list
                    files.value.unshift(response.data);
                    selectedFile.value = null;
                    if (fileInput.value) {
                        fileInput.value.value = '';
                    }
                } catch (error) {
                    alert('File upload failed. Please try again.');
                    console.error('Upload error:', error);
                } finally {
                    isUploading.value = false;
                }
            };

            const fetchFiles = async () => {
                isLoadingFiles.value = true;
                try {
                    const response = await axios.get('/api/v1/files');
                    files.value = response.data;
                } catch (error) {
                    console.error('Error fetching files:', error);
                    alert('Failed to load files. Please try again.');
                } finally {
                    isLoadingFiles.value = false;
                }
            };

            const refreshFiles = async () => {
                isRefreshing.value = true;
                await fetchFiles();
                isRefreshing.value = false;
            };

            const viewSummary = (file) => {
                currentSummaryFile.value = file;
                showSummaryModal.value = true;
                isLoadingSummary.value = true;

                // Simulate loading summary
                setTimeout(() => {
                    isLoadingSummary.value = false;
                }, 1000);
            };

            const openFilePreview = async (file) => {
                showFilePreview.value = true;
                currentPreviewFile.value = file;
                isLoadingFileContent.value = true;
                fileContent.value = '';
                try {
                    // Always fetch file details from backend
                    const response = await axios.get(`/api/v1/file/${file.uuid}`);
                    fileContent.value = md ? md.render(response.data) : response.data;
                } catch (error) {
                    console.error('Error fetching file content:', error);
                    fileContent.value = 'Could not load file details';
                } finally {
                    isLoadingFileContent.value = false;
                }
            };

            const deleteFile = async (uuid) => {
                if (!confirm('Are you sure you want to delete this file?')) return;

                try {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 500));

                    // In a real app, this would be:
                    // await axios.delete(`/api/v1/files/${uuid}`);

                    files.value = files.value.filter(file => file.uuid !== uuid);
                } catch (error) {
                    console.error('Error deleting file:', error);
                    alert('Failed to delete file. Please try again.');
                }
            };

            // Lifecycle hooks
            onMounted(() => {
                checkAuth();

                // For demo purposes, simulate authenticated user
                // setTimeout(() => {
                //     isAuthenticated.value = true;
                //     fetchFiles();
                // }, 500);
            });

            // ...existing code...
            const goToRegister = () => {
                currentView.value = 'register';
            };
            // ...existing code...
            return {
                currentView,
                isAuthenticated,
                showVideoForm,
                isDragging,
                selectedFile,
                isUploading,
                files,
                isLoadingFiles,
                isRefreshing,
                filterStatus,
                showSummaryModal,
                currentSummaryFile,
                isLoadingSummary,
                loginForm,
                registerForm,
                isLoggingIn,
                isRegistering,
                fileInput,
                filteredFiles,
                triggerFileInput,
                handleFileSelect,
                handleDrop,
                removeFile,
                formatFileSize,
                getFileIcon,
                getFileType,
                getStatusText,
                handleLogin,
                handleRegister,
                logout,
                uploadFile,
                fetchFiles,
                refreshFiles,
                viewSummary,
                deleteFile,
                openFilePreview,
                showFilePreview,
                currentPreviewFile,
                fileContent,
                isLoadingFileContent,
                goToRegister
            };
        }
    }).mount('#app');
</script>
</body>
</html>